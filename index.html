<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hayat ƒ∞≈ületim Sistemi</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { -webkit-tap-highlight-color: transparent; }
        input, button, select { outline: none; }
        .foggy-event {
            background: rgba(59, 130, 246, 0.15);
            backdrop-filter: blur(2px);
            border-left: 3px solid rgba(59, 130, 246, 0.5);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ƒ∞KONLAR ---
        const Icons = {
            Plus: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            Trash: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Check: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"></polyline></svg>,
            Briefcase: () => <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>,
            Calendar: () => <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>,
            Clock: () => <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>,
            ChevronLeft: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="15 18 9 12 15 6"></polyline></svg>,
            ChevronRight: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"></polyline></svg>,
            Close: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
            Target: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
        };

        // --- RENK SKALASI ---
        const getScoreColor = (score) => {
            if (score === 1) return 'bg-red-500 text-white';
            if (score === 2) return 'bg-orange-500 text-white';
            if (score === 3) return 'bg-yellow-400 text-black';
            if (score === 4) return 'bg-green-500 text-white';
            if (score === 5) return 'bg-cyan-400 text-white shadow-[0_0_15px_rgba(34,211,238,0.6)]'; // Turkuaz ve Parlak
            return 'bg-gray-200 text-gray-400';
        };

        function App() {
            // --- STATE ---
            const [projects, setProjects] = useState(() => JSON.parse(localStorage.getItem('v3_projects') || '[]'));
            // T√ºm g√∂revler artƒ±k tarih bazlƒ± saklanƒ±yor: { "2024-11-21": [Task1, Task2] }
            const [history, setHistory] = useState(() => JSON.parse(localStorage.getItem('v3_history') || '{}'));
            
            const [activeTab, setActiveTab] = useState('planner');
            const [selectedDate, setSelectedDate] = useState(new Date()); // Se√ßili g√ºn
            
            // Modallar
            const [modal, setModal] = useState({ open: false, type: null, data: null }); // type: 'selection', 'new_simple', 'import_project', 'project_new'
            
            // Form
            const [form, setForm] = useState({ title: '', total: '', unit: '', estTime: '', amount: '', time: '', startTime: '' });

            // --- KAYDETME ---
            useEffect(() => { localStorage.setItem('v3_projects', JSON.stringify(projects)); }, [projects]);
            useEffect(() => { localStorage.setItem('v3_history', JSON.stringify(history)); }, [history]);

            // --- YARDIMCI FONKSƒ∞YONLAR ---
            const getDateKey = (date) => date.toISOString().split('T')[0];
            const dateKey = getDateKey(selectedDate);
            
            const currentTasks = history[dateKey] || [];

            // G√ºnl√ºk Skor Hesaplama (1-5)
            const calculateDailyScore = (tasks) => {
                if (!tasks || tasks.length === 0) return 0;
                const totalDuration = tasks.reduce((acc, t) => acc + Number(t.duration || 0), 0);
                if (totalDuration === 0) return 0; // S√ºre girilmemi≈üse hesaplanamaz

                // Tamamlanan g√∂revlerin s√ºresi + Kƒ±smi tamamlanan par√ßalar
                let completedDuration = 0;
                tasks.forEach(t => {
                    if (t.subItems) {
                        // Alt adƒ±mlƒ± g√∂revlerde tamamlanan adƒ±m oranƒ± kadar s√ºre ekle
                        const doneCount = t.subItems.filter(s => s).length;
                        const ratio = doneCount / t.subItems.length;
                        completedDuration += (Number(t.duration) * ratio);
                    } else if (t.completed) {
                        completedDuration += Number(t.duration);
                    }
                });

                const percentage = (completedDuration / totalDuration) * 100;
                if (percentage === 0) return 1;
                if (percentage < 40) return 2;
                if (percentage < 70) return 3;
                if (percentage < 90) return 4;
                return 5;
            };

            const dailyScore = calculateDailyScore(currentTasks);

            // --- CRUD ƒ∞≈ûLEMLERƒ∞ ---

            const handleAddProject = () => {
                if(!form.title) return;
                const newProject = {
                    id: Date.now(),
                    title: form.title,
                    totalUnit: Number(form.total) || 100,
                    currentUnit: 0,
                    unit: form.unit || 'br',
                    totalEstTime: Number(form.estTime) || 0, // Toplam Tahmini Saat
                };
                setProjects([...projects, newProject]);
                closeModal();
            };

            const handleAddTask = (type) => {
                let newTask;
                
                if (type === 'simple') {
                    newTask = {
                        id: Date.now(),
                        title: form.title,
                        type: 'simple',
                        completed: false,
                        duration: form.time || '30',
                        startTime: form.startTime || '', // √ñrn: "14:00"
                    };
                } else if (type === 'import') {
                    // Projeden √ßekilen g√∂rev
                    const p = modal.data;
                    const amount = Number(form.amount);
                    
                    // Alt adƒ±mlarƒ± olu≈ütur (√ñrn: 4 video -> [false, false, false, false])
                    const subItems = new Array(amount).fill(false);

                    newTask = {
                        id: Date.now(),
                        title: `${p.title} (${amount} ${p.unit})`,
                        type: 'project_slice',
                        pid: p.id,
                        targetAmount: amount,
                        subItems: subItems, // Alt adƒ±mlar
                        completed: false,
                        duration: form.time || '60',
                        startTime: form.startTime || '',
                    };
                }

                const updatedTasks = [...currentTasks, newTask];
                setHistory({ ...history, [dateKey]: updatedTasks });
                closeModal();
            };

            const toggleSubItem = (taskId, index) => {
                const updatedTasks = currentTasks.map(t => {
                    if (t.id === taskId) {
                        const newSubItems = [...t.subItems];
                        newSubItems[index] = !newSubItems[index];
                        
                        // Hepsi bittiyse ana g√∂revi de tamamlandƒ± yap
                        const allDone = newSubItems.every(i => i === true);
                        
                        // Proje ilerlemesini g√ºncelle
                        if (t.type === 'project_slice') {
                             updateProjectProgress(t.pid, newSubItems[index] ? 1 : -1); // +1 veya -1 birim
                        }

                        return { ...t, subItems: newSubItems, completed: allDone };
                    }
                    return t;
                });
                setHistory({ ...history, [dateKey]: updatedTasks });
            };

            const toggleTask = (taskId) => {
                const updatedTasks = currentTasks.map(t => {
                    if (t.id === taskId) {
                        const newStatus = !t.completed;
                        // Basit g√∂revse direkt deƒüi≈ütir, Proje ise (alt adƒ±mlarƒ± yoksa) ilerlemeyi g√ºncelle
                        if (t.type === 'project_slice' && !t.subItems) {
                             // Bu senaryo ≈üu an yok √ß√ºnk√º hep subItem ekliyoruz ama g√ºvenlik i√ßin kalsƒ±n
                             updateProjectProgress(t.pid, newStatus ? t.targetAmount : -t.targetAmount);
                        }
                        return { ...t, completed: newStatus };
                    }
                    return t;
                });
                setHistory({ ...history, [dateKey]: updatedTasks });
            };

            const updateProjectProgress = (pid, changeAmount) => {
                setProjects(prev => prev.map(p => {
                    if (p.id === pid) {
                        const newCurrent = Math.min(p.totalUnit, Math.max(0, p.currentUnit + changeAmount));
                        return { ...p, currentUnit: newCurrent };
                    }
                    return p;
                }));
            };

            const deleteTask = (taskId) => {
                // Eƒüer proje par√ßasƒ±ysa ve yapƒ±ldƒ±ysa, silerken projeden d√º≈ümeli miyiz? 
                // Karma≈üƒ±klƒ±k olmasƒ±n diye silinen g√∂rev projeyi etkilemiyor diyelim ≈üimdilik.
                const updatedTasks = currentTasks.filter(t => t.id !== taskId);
                setHistory({ ...history, [dateKey]: updatedTasks });
            };

            const changeDate = (days) => {
                const newDate = new Date(selectedDate);
                newDate.setDate(newDate.getDate() + days);
                setSelectedDate(newDate);
            };

            const openModal = (type, data=null) => {
                setModal({ open: true, type, data });
                setForm({ title: '', total: '', unit: '', estTime: '', amount: '', time: '', startTime: '' });
            };
            const closeModal = () => setModal({ open: false, type: null, data: null });

            // --- G√ñR√úN√úM Bƒ∞LE≈ûENLERƒ∞ ---

            const CalendarView = () => {
                // Basit Ay G√∂r√ºn√ºm√º
                const year = selectedDate.getFullYear();
                const month = selectedDate.getMonth();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const firstDay = new Date(year, month, 1).getDay(); // 0 Pazar
                
                // Haftanƒ±n g√ºnleri (Pazartesi ba≈ülasƒ±n diye ayar)
                const padding = firstDay === 0 ? 6 : firstDay - 1; 
                const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);

                return (
                    <div className="bg-white rounded-xl shadow-sm border p-4">
                        <h3 className="font-bold text-center mb-4 text-lg capitalize">
                            {selectedDate.toLocaleDateString('tr-TR', { month: 'long', year: 'numeric' })}
                        </h3>
                        <div className="grid grid-cols-7 gap-2 text-center text-sm mb-2 font-medium text-gray-400">
                            <div>Pt</div><div>Sa</div><div>√áa</div><div>Pe</div><div>Cu</div><div>Ct</div><div>Pz</div>
                        </div>
                        <div className="grid grid-cols-7 gap-2">
                            {Array(padding).fill(null).map((_, i) => <div key={`pad-${i}`}></div>)}
                            {days.map(d => {
                                const dStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                                const dayData = history[dStr];
                                const score = dayData ? calculateDailyScore(dayData) : 0;
                                const isToday = dStr === getDateKey(new Date());
                                const isSelected = dStr === dateKey;
                                
                                return (
                                    <div 
                                        key={d} 
                                        onClick={() => setSelectedDate(new Date(dStr))}
                                        className={`aspect-square flex items-center justify-center rounded-lg text-sm font-medium cursor-pointer transition-all border
                                            ${isSelected ? 'ring-2 ring-indigo-600 scale-110 z-10' : 'border-transparent'}
                                            ${dayData ? getScoreColor(score) : 'bg-gray-100 text-gray-400 hover:bg-gray-200'}
                                        `}
                                    >
                                        {d}
                                    </div>
                                )
                            })}
                        </div>
                    </div>
                );
            };

            const ScheduleView = () => {
                // Sisli Zaman √áizelgesi
                const hours = Array.from({length: 17}, (_, i) => i + 7); // 07:00 - 23:00
                
                return (
                    <div className="bg-white rounded-xl shadow-sm border p-4 mt-6 relative overflow-hidden">
                        <h3 className="font-bold mb-4 flex items-center gap-2 text-indigo-900">
                            <Icons.Clock /> Sisli Zaman Akƒ±≈üƒ±
                        </h3>
                        <div className="space-y-4 relative">
                            {hours.map(h => {
                                const timeStr = String(h).padStart(2, '0') + ":00";
                                // O saatteki g√∂revleri bul (Basit mantƒ±k: Ba≈ülangƒ±√ß saati e≈üle≈üen)
                                const activeTasks = currentTasks.filter(t => t.startTime && t.startTime.startsWith(String(h).padStart(2, '0')));
                                
                                return (
                                    <div key={h} className="flex gap-4 relative min-h-[3rem]">
                                        <div className="w-12 text-xs text-gray-400 pt-1">{timeStr}</div>
                                        <div className="flex-1 border-t border-gray-100 relative">
                                            {/* Sisli Bloklar */}
                                            {activeTasks.map(t => (
                                                <div key={t.id} className="foggy-event absolute top-0 left-0 right-0 bottom-0 mb-1 p-2 rounded text-xs text-blue-800 font-medium flex justify-between">
                                                    <span>{t.title}</span>
                                                    <span>{t.duration}dk</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )
                            })}
                            {/* Saati olmayanlar i√ßin altta bir havuz */}
                            <div className="mt-4 pt-4 border-t border-dashed">
                                <div className="text-xs text-gray-400 mb-2">Saatsiz G√∂revler</div>
                                <div className="flex flex-wrap gap-2">
                                    {currentTasks.filter(t => !t.startTime).map(t => (
                                        <span key={t.id} className={`text-xs px-2 py-1 rounded border ${t.completed ? 'bg-green-50 text-green-600 border-green-200' : 'bg-gray-50 border-gray-200'}`}>
                                            {t.title}
                                        </span>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                )
            };

            return (
                <div className="flex flex-col h-screen max-w-md mx-auto bg-gray-50 shadow-2xl overflow-hidden">
                    
                    {/* --- HEADER --- */}
                    <div className="bg-white p-4 pt-10 pb-4 border-b shadow-sm z-20">
                        <div className="flex justify-between items-center mb-4">
                            <h1 className="text-xl font-bold text-gray-800 tracking-tight">
                                {activeTab === 'planner' ? 'Ya≈üam Paneli' : activeTab === 'calendar' ? 'Takvim & Isƒ±' : 'Projeler'}
                            </h1>
                            <div className={`px-3 py-1 rounded-full text-xs font-bold ${getScoreColor(dailyScore)}`}>
                                G√ºnl√ºk Puan: {dailyScore}/5
                            </div>
                        </div>
                        
                        {activeTab === 'planner' && (
                            <div className="flex items-center justify-between bg-gray-100 rounded-lg p-1">
                                <button onClick={() => changeDate(-1)} className="p-2 text-gray-500 hover:bg-white rounded-md transition"><Icons.ChevronLeft/></button>
                                <div className="text-sm font-medium flex flex-col items-center">
                                    <span className={dateKey === getDateKey(new Date()) ? "text-indigo-600 font-bold" : "text-gray-700"}>
                                        {selectedDate.toLocaleDateString('tr-TR', { weekday: 'long', day: 'numeric', month: 'short' })}
                                    </span>
                                    {dateKey === getDateKey(new Date()) && <span className="text-[10px] text-indigo-400">Bug√ºn</span>}
                                </div>
                                <button onClick={() => changeDate(1)} className="p-2 text-gray-500 hover:bg-white rounded-md transition"><Icons.ChevronRight/></button>
                            </div>
                        )}
                    </div>

                    {/* --- CONTENT --- */}
                    <div className="flex-1 overflow-y-auto p-4 space-y-6 scroll-smooth">
                        
                        {/* PLANNER TAB */}
                        {activeTab === 'planner' && (
                            <>
                                {/* G√∂rev Listesi */}
                                <div className="space-y-3">
                                    {currentTasks.length === 0 && (
                                        <div className="text-center py-10 opacity-50">
                                            <div className="text-4xl mb-2">üçÉ</div>
                                            <div>Bu g√ºn i√ßin hen√ºz plan yok.</div>
                                        </div>
                                    )}
                                    
                                    {currentTasks.map(t => (
                                        <div key={t.id} className={`bg-white rounded-xl p-4 shadow-sm border transition-all ${t.completed ? 'opacity-75 bg-gray-50' : 'border-indigo-50 hover:border-indigo-200'}`}>
                                            <div className="flex items-start gap-3">
                                                {/* Ana Checkbox (Sadece Basit G√∂revler ƒ∞√ßin) */}
                                                {t.type === 'simple' ? (
                                                    <button onClick={() => toggleTask(t.id)} className={`mt-1 min-w-[20px] h-5 rounded-full border-2 flex items-center justify-center transition ${t.completed ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300'}`}>
                                                        {t.completed && <Icons.Check />}
                                                    </button>
                                                ) : (
                                                    <div className="mt-1 min-w-[20px] flex justify-center"><Icons.Target /></div>
                                                )}

                                                <div className="flex-1">
                                                    <div className={`font-medium text-gray-800 ${t.completed ? 'line-through text-gray-400' : ''}`}>{t.title}</div>
                                                    <div className="flex gap-3 text-xs text-gray-400 mt-1">
                                                        <span className="flex items-center gap-1"><Icons.Clock /> {t.duration} dk</span>
                                                        {t.startTime && <span className="text-indigo-400">{t.startTime}</span>}
                                                    </div>

                                                    {/* Alt Adƒ±mlar (Projeden √áekilenler) */}
                                                    {t.subItems && (
                                                        <div className="flex flex-wrap gap-2 mt-3">
                                                            {t.subItems.map((isDone, idx) => (
                                                                <button 
                                                                    key={idx}
                                                                    onClick={() => toggleSubItem(t.id, idx)}
                                                                    className={`w-8 h-8 rounded border flex items-center justify-center transition-colors text-xs font-bold
                                                                        ${isDone ? 'bg-green-500 border-green-500 text-white' : 'bg-white border-gray-300 text-gray-400 hover:border-indigo-400'}
                                                                    `}
                                                                >
                                                                    {isDone ? <Icons.Check /> : idx + 1}
                                                                </button>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                                
                                                <button onClick={() => deleteTask(t.id)} className="text-gray-300 hover:text-red-500 p-1"><Icons.Trash /></button>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <button onClick={() => openModal('selection')} className="w-full py-3 mt-2 border-2 border-dashed border-gray-300 rounded-xl text-gray-400 font-medium hover:border-indigo-400 hover:text-indigo-500 transition flex items-center justify-center gap-2">
                                    <Icons.Plus /> G√∂rev Ekle
                                </button>
                            </>
                        )}

                        {/* TAKVƒ∞M & ZAMAN TABI */}
                        {activeTab === 'calendar' && (
                            <div className="space-y-6">
                                <CalendarView />
                                <ScheduleView />
                            </div>
                        )}

                        {/* PROJELER TABI */}
                        {activeTab === 'projects' && (
                            <div className="space-y-4">
                                <div className="flex justify-between items-center">
                                    <h2 className="font-bold text-lg">B√ºy√ºk Hedeflerim</h2>
                                    <button onClick={() => openModal('project_new')} className="text-indigo-600 text-sm font-medium hover:underline">+ Yeni Proje</button>
                                </div>
                                
                                {projects.map(p => {
                                    const pct = Math.min(100, Math.round((p.currentUnit / p.totalUnit) * 100));
                                    // Tahmini Kalan S√ºre Hesabƒ±
                                    // (Toplam S√ºre / Toplam Birim) * Kalan Birim
                                    const remainingUnit = p.totalUnit - p.currentUnit;
                                    const timePerUnit = p.totalEstTime > 0 ? p.totalEstTime / p.totalUnit : 0;
                                    const remainingTime = Math.round(remainingUnit * timePerUnit);

                                    return (
                                        <div key={p.id} className="bg-white p-5 rounded-xl shadow-sm border border-gray-100 relative overflow-hidden">
                                            <div className="flex justify-between mb-2 relative z-10">
                                                <h3 className="font-bold text-gray-800 text-lg">{p.title}</h3>
                                                <div className="text-xs font-bold px-2 py-1 bg-indigo-50 text-indigo-700 rounded">
                                                    %{pct}
                                                </div>
                                            </div>
                                            
                                            <div className="flex gap-4 text-xs text-gray-500 mb-3 relative z-10">
                                                <span>üéØ {p.currentUnit}/{p.totalUnit} {p.unit}</span>
                                                {p.totalEstTime > 0 && (
                                                    <span>‚è≥ Tahmini Kalan: {remainingTime} saat</span>
                                                )}
                                            </div>

                                            {/* Progress Bar */}
                                            <div className="h-2 bg-gray-100 rounded-full overflow-hidden mb-4 relative z-10">
                                                <div className={`h-full transition-all duration-1000 ${pct>=100 ? 'bg-green-500':'bg-indigo-500'}`} style={{width: `${pct}%`}}></div>
                                            </div>
                                            
                                            {/* Arka plan dekoru */}
                                            <div className="absolute -right-5 -bottom-5 text-gray-50 opacity-50 z-0">
                                                <svg width="100" height="100" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"></circle></svg>
                                            </div>
                                        </div>
                                    )
                                })}
                            </div>
                        )}

                        <div className="h-20"></div> {/* Alt bo≈üluk */}
                    </div>

                    {/* --- BOTTOM NAV --- */}
                    <div className="bg-white border-t flex pb-safe pt-1">
                        <button onClick={() => setActiveTab('calendar')} className={`flex-1 p-3 flex flex-col items-center gap-1 ${activeTab==='calendar' ? 'text-indigo-600':'text-gray-400'}`}>
                            <Icons.Calendar /> <span className="text-[10px] font-medium">Takvim</span>
                        </button>
                        <button onClick={() => setActiveTab('planner')} className={`flex-1 p-3 flex flex-col items-center gap-1 -mt-6`}>
                            <div className={`w-14 h-14 rounded-full shadow-lg flex items-center justify-center border-4 border-gray-50 ${activeTab==='planner' ? 'bg-indigo-600 text-white' : 'bg-white text-gray-400'}`}>
                                <div className="scale-125"><Icons.Plus /></div>
                            </div>
                        </button>
                        <button onClick={() => setActiveTab('projects')} className={`flex-1 p-3 flex flex-col items-center gap-1 ${activeTab==='projects' ? 'text-indigo-600':'text-gray-400'}`}>
                            <Icons.Briefcase /> <span className="text-[10px] font-medium">Projeler</span>
                        </button>
                    </div>

                    {/* --- MODALLAR --- */}
                    {modal.open && (
                        <div className="fixed inset-0 bg-black/60 flex items-end sm:items-center justify-center z-50 backdrop-blur-sm p-4">
                            <div className="bg-white w-full sm:w-96 rounded-2xl p-6 shadow-2xl animate-[slide-up_0.3s_ease-out]">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-xl font-bold text-gray-800">
                                        {modal.type === 'selection' ? 'Ne Ekleyelim?' : 
                                         modal.type === 'project_new' ? 'Yeni B√ºy√ºk Hedef' :
                                         modal.type === 'import' ? 'Projeden √áek' : 'Yeni G√∂rev'}
                                    </h3>
                                    <button onClick={closeModal} className="bg-gray-100 p-1 rounded-full"><Icons.Close /></button>
                                </div>

                                {/* 1. SE√áƒ∞M EKRANI */}
                                {modal.type === 'selection' && (
                                    <div className="space-y-3">
                                        <button onClick={() => openModal('new_simple')} className="w-full p-4 bg-indigo-50 text-indigo-700 rounded-xl font-bold flex items-center gap-3 hover:bg-indigo-100 transition">
                                            <div className="bg-white p-2 rounded-full shadow-sm"><Icons.Plus /></div>
                                            Basit, Tek Seferlik G√∂rev
                                        </button>
                                        <div className="text-xs text-gray-400 font-bold uppercase tracking-wider ml-1 mt-4 mb-2">Aktif Projelerden √áek</div>
                                        {projects.length === 0 && <div className="text-sm text-gray-400 italic p-2">Hen√ºz proje yok.</div>}
                                        <div className="max-h-60 overflow-y-auto space-y-2">
                                            {projects.map(p => (
                                                <button key={p.id} onClick={() => openModal('import', p)} className="w-full p-3 border border-gray-200 rounded-xl text-left hover:border-indigo-500 hover:shadow-md transition flex justify-between items-center group">
                                                    <span className="font-medium text-gray-700 group-hover:text-indigo-600">{p.title}</span>
                                                    <span className="text-xs bg-gray-100 px-2 py-1 rounded text-gray-500">{p.unit}</span>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* 2. YENƒ∞ PROJE FORMU */}
                                {modal.type === 'project_new' && (
                                    <div className="space-y-4">
                                        <input placeholder="Proje Adƒ± (√ñrn: YKS Matematik)" className="w-full p-3 bg-gray-50 rounded-xl border focus:ring-2 ring-indigo-200" autoFocus value={form.title} onChange={e=>setForm({...form, title: e.target.value})} />
                                        <div className="flex gap-3">
                                            <div className="flex-1">
                                                <label className="text-xs text-gray-500 ml-1">Toplam Y√ºk</label>
                                                <input type="number" placeholder="100" className="w-full p-3 bg-gray-50 rounded-xl border" value={form.total} onChange={e=>setForm({...form, total: e.target.value})} />
                                            </div>
                                            <div className="flex-1">
                                                <label className="text-xs text-gray-500 ml-1">Birim</label>
                                                <input placeholder="Slayt/Video" className="w-full p-3 bg-gray-50 rounded-xl border" value={form.unit} onChange={e=>setForm({...form, unit: e.target.value})} />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="text-xs text-gray-500 ml-1">Toplam Tahmini S√ºre (Saat)</label>
                                            <input type="number" placeholder="√ñrn: 50" className="w-full p-3 bg-gray-50 rounded-xl border" value={form.estTime} onChange={e=>setForm({...form, estTime: e.target.value})} />
                                        </div>
                                        <button onClick={handleAddProject} className="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 shadow-lg shadow-indigo-200">Projeyi Ba≈ülat</button>
                                    </div>
                                )}

                                {/* 3. PROJEDEN G√ñREV √áEKME FORMU */}
                                {modal.type === 'import' && (
                                    <div className="space-y-4">
                                        <div className="text-indigo-600 font-medium bg-indigo-50 p-3 rounded-lg border border-indigo-100 text-center">
                                            {modal.data.title}
                                        </div>
                                        <div>
                                            <label className="text-xs text-gray-500 ml-1">Bug√ºn Ka√ß {modal.data.unit}?</label>
                                            <input type="number" autoFocus placeholder="√ñrn: 4" className="w-full p-3 bg-gray-50 rounded-xl border text-lg font-bold text-center" value={form.amount} onChange={e=>setForm({...form, amount: e.target.value})} />
                                            <p className="text-xs text-gray-400 mt-1 text-center">Bu g√∂rev {form.amount || 0} ayrƒ± kutucuk olu≈üturacak.</p>
                                        </div>
                                        <div className="flex gap-3">
                                            <div className="flex-1">
                                                <label className="text-xs text-gray-500 ml-1">S√ºre (Dk)</label>
                                                <input type="number" placeholder="60" className="w-full p-3 bg-gray-50 rounded-xl border" value={form.time} onChange={e=>setForm({...form, time: e.target.value})} />
                                            </div>
                                            <div className="flex-1">
                                                <label className="text-xs text-gray-500 ml-1">Ba≈ülangƒ±√ß (Opsiyonel)</label>
                                                <input type="time" className="w-full p-3 bg-gray-50 rounded-xl border" value={form.startTime} onChange={e=>setForm({...form, startTime: e.target.value})} />
                                            </div>
                                        </div>
                                        <button onClick={() => handleAddTask('import')} className="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 shadow-lg shadow-indigo-200">Planƒ±na Ekle</button>
                                    </div>
                                )}

                                {/* 4. BASƒ∞T G√ñREV FORMU */}
                                {modal.type === 'new_simple' && (
                                    <div className="space-y-4">
                                        <input placeholder="G√∂rev Adƒ±" autoFocus className="w-full p-3 bg-gray-50 rounded-xl border focus:ring-2 ring-indigo-200" value={form.title} onChange={e=>setForm({...form, title: e.target.value})} />
                                        <div className="flex gap-3">
                                            <div className="flex-1">
                                                <label className="text-xs text-gray-500 ml-1">S√ºre (Dk)</label>
                                                <input type="number" placeholder="30" className="w-full p-3 bg-gray-50 rounded-xl border" value={form.time} onChange={e=>setForm({...form, time: e.target.value})} />
                                            </div>
                                            <div className="flex-1">
                                                <label className="text-xs text-gray-500 ml-1">Ba≈ülangƒ±√ß (Opsiyonel)</label>
                                                <input type="time" className="w-full p-3 bg-gray-50 rounded-xl border" value={form.startTime} onChange={e=>setForm({...form, startTime: e.target.value})} />
                                            </div>
                                        </div>
                                        <button onClick={() => handleAddTask('simple')} className="w-full bg-gray-900 text-white py-3 rounded-xl font-bold hover:bg-gray-800 shadow-lg">Ekle</button>
                                    </div>
                                )}

                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
