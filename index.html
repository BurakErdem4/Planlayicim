<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hedef Planlayıcı</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { -webkit-tap-highlight-color: transparent; }
        input, button { outline: none; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- İkonlar (SVG) ---
        const Icons = {
            Plus: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            Trash: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Check: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>,
            Briefcase: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>,
            Calendar: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>,
            Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>,
            ArrowRight: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>,
            Close: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        };

        function App() {
            // --- State ---
            const [projects, setProjects] = useState(() => JSON.parse(localStorage.getItem('projects') || '[]'));
            const [tasks, setTasks] = useState(() => JSON.parse(localStorage.getItem('tasks') || '[]'));
            const [activeTab, setActiveTab] = useState('planner');
            const [modal, setModal] = useState({ open: false, type: null, data: null }); // type: 'project', 'task', 'slice'
            
            // Form State
            const [form, setForm] = useState({ title: '', total: '', unit: '', amount: '', time: '' });

            useEffect(() => { localStorage.setItem('projects', JSON.stringify(projects)); }, [projects]);
            useEffect(() => { localStorage.setItem('tasks', JSON.stringify(tasks)); }, [tasks]);

            // --- Actions ---
            const addProject = () => {
                if(!form.title) return;
                setProjects([...projects, {
                    id: Date.now(), title: form.title, total: Number(form.total)||100, current: 0, unit: form.unit||'br'
                }]);
                closeModal();
            };

            const addTask = () => {
                if(!form.title) return;
                setTasks([...tasks, {
                    id: Date.now(), title: form.title, type: 'simple', completed: false, duration: form.time || '15', date: new Date().toDateString()
                }]);
                closeModal();
            };

            const addSlice = () => {
                if(!modal.data || !form.amount) return;
                setTasks([...tasks, {
                    id: Date.now(), title: `${modal.data.title} (${form.amount} ${modal.data.unit})`,
                    type: 'slice', pid: modal.data.id, target: Number(form.amount), completed: false, duration: form.time || '30', date: new Date().toDateString()
                }]);
                closeModal();
            };

            const toggleTask = (id) => {
                const task = tasks.find(t => t.id === id);
                const newStatus = !task.completed;
                setTasks(tasks.map(t => t.id === id ? {...t, completed: newStatus} : t));

                if(task.type === 'slice') {
                    setProjects(projects.map(p => {
                        if(p.id === task.pid) {
                            const change = newStatus ? task.target : -task.target;
                            return {...p, current: Math.min(p.total, Math.max(0, p.current + change))};
                        }
                        return p;
                    }));
                }
            };

            const deleteTask = (id) => setTasks(tasks.filter(t => t.id !== id));
            const deleteProject = (id) => setProjects(projects.filter(p => p.id !== id));

            const openModal = (type, data=null) => {
                setModal({ open: true, type, data });
                setForm({ title: '', total: '', unit: '', amount: '', time: '' });
            };
            const closeModal = () => setModal({ open: false, type: null, data: null });

            // --- Render ---
            return (
                <div className="flex flex-col h-screen max-w-md mx-auto bg-white shadow-xl overflow-hidden">
                    {/* Header */}
                    <div className="p-5 bg-white border-b flex justify-between items-center pt-10">
                        <h1 className="text-2xl font-bold text-indigo-900">
                            {activeTab === 'planner' ? 'Bugünün Planı' : 'Proje Havuzu'}
                        </h1>
                        <button onClick={() => openModal(activeTab === 'planner' ? 'task' : 'project')} className="bg-indigo-600 text-white p-2 rounded-full shadow-lg active:scale-90 transition">
                            <Icons.Plus />
                        </button>
                    </div>

                    {/* Content */}
                    <div className="flex-1 overflow-y-auto p-4 bg-gray-50">
                        
                        {/* PLANNER TAB */}
                        {activeTab === 'planner' && (
                            <div className="space-y-3">
                                {tasks.length === 0 && <div className="text-center text-gray-400 mt-10">Bugün boş.</div>}
                                {tasks.map(t => (
                                    <div key={t.id} className={`bg-white p-4 rounded-xl shadow-sm border flex items-center gap-3 transition ${t.completed ? 'opacity-60 bg-green-50 border-green-100' : 'border-gray-100'}`}>
                                        <button onClick={() => toggleTask(t.id)} className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition ${t.completed ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300'}`}>
                                            {t.completed && <Icons.Check />}
                                        </button>
                                        <div className="flex-1">
                                            <div className={`font-medium ${t.completed ? 'line-through text-gray-400' : 'text-gray-800'}`}>{t.title}</div>
                                            <div className="text-xs text-gray-500 flex items-center gap-1 mt-1"><Icons.Clock /> {t.duration} dk</div>
                                        </div>
                                        <button onClick={() => deleteTask(t.id)} className="text-gray-300 hover:text-red-500"><Icons.Trash /></button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* PROJECTS TAB */}
                        {activeTab === 'projects' && (
                            <div className="space-y-4">
                                {projects.length === 0 && <div className="text-center text-gray-400 mt-10">Proje yok.</div>}
                                {projects.map(p => {
                                    const pct = Math.min(100, Math.round((p.current / p.total) * 100));
                                    return (
                                        <div key={p.id} className="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
                                            <div className="flex justify-between mb-2">
                                                <h3 className="font-bold text-gray-800">{p.title}</h3>
                                                <button onClick={() => deleteProject(p.id)} className="text-gray-300 hover:text-red-500"><Icons.Trash /></button>
                                            </div>
                                            <div className="text-xs text-gray-500 mb-1 flex justify-between">
                                                <span>İlerleme</span>
                                                <span>{p.current} / {p.total} {p.unit}</span>
                                            </div>
                                            <div className="h-2 bg-gray-100 rounded-full overflow-hidden mb-4">
                                                <div className={`h-full transition-all duration-500 ${pct>=100 ? 'bg-green-500':'bg-indigo-500'}`} style={{width: `${pct}%`}}></div>
                                            </div>
                                            <button 
                                                onClick={() => openModal('slice', p)}
                                                disabled={pct >= 100}
                                                className="w-full py-2 bg-indigo-50 text-indigo-600 rounded-lg text-sm font-medium flex justify-center items-center gap-2 disabled:opacity-50"
                                            >
                                                {pct >= 100 ? 'Tamamlandı' : 'Bugüne Parça Ekle'} <Icons.ArrowRight />
                                            </button>
                                        </div>
                                    )
                                })}
                            </div>
                        )}
                    </div>

                    {/* Bottom Nav */}
                    <div className="bg-white border-t flex">
                        <button onClick={() => setActiveTab('planner')} className={`flex-1 p-4 flex flex-col items-center gap-1 ${activeTab==='planner' ? 'text-indigo-600':'text-gray-400'}`}>
                            <Icons.Calendar /> <span className="text-xs font-medium">Planlayıcı</span>
                        </button>
                        <button onClick={() => setActiveTab('projects')} className={`flex-1 p-4 flex flex-col items-center gap-1 ${activeTab==='projects' ? 'text-indigo-600':'text-gray-400'}`}>
                            <Icons.Briefcase /> <span className="text-xs font-medium">Projeler</span>
                        </button>
                    </div>

                    {/* Modal */}
                    {modal.open && (
                        <div className="fixed inset-0 bg-black/50 flex items-end sm:items-center justify-center z-50 backdrop-blur-sm">
                            <div className="bg-white w-full sm:w-96 rounded-t-2xl sm:rounded-2xl p-6 animate-in slide-in-from-bottom duration-300">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold">
                                        {modal.type === 'project' ? 'Yeni Proje' : modal.type === 'slice' ? 'Parça Ekle' : 'Yeni Görev'}
                                    </h3>
                                    <button onClick={closeModal}><Icons.Close /></button>
                                </div>

                                <div className="space-y-3">
                                    {modal.type === 'project' ? (
                                        <>
                                            <input placeholder="Proje Adı (Örn: Matematik)" className="w-full p-3 bg-gray-50 rounded-lg border" value={form.title} onChange={e=>setForm({...form, title: e.target.value})} />
                                            <div className="flex gap-3">
                                                <input type="number" placeholder="Hedef (100)" className="w-full p-3 bg-gray-50 rounded-lg border" value={form.total} onChange={e=>setForm({...form, total: e.target.value})} />
                                                <input placeholder="Birim (Slayt)" className="w-full p-3 bg-gray-50 rounded-lg border" value={form.unit} onChange={e=>setForm({...form, unit: e.target.value})} />
                                            </div>
                                        </>
                                    ) : modal.type === 'slice' ? (
                                        <>
                                            <div className="text-indigo-600 font-medium text-sm">{modal.data.title}</div>
                                            <div className="flex items-center gap-2">
                                                <input type="number" placeholder="Bugünkü Miktar" className="flex-1 p-3 bg-gray-50 rounded-lg border" value={form.amount} onChange={e=>setForm({...form, amount: e.target.value})} />
                                                <span className="text-gray-500">{modal.data.unit}</span>
                                            </div>
                                            <input type="number" placeholder="Süre (dk)" className="w-full p-3 bg-gray-50 rounded-lg border" value={form.time} onChange={e=>setForm({...form, time: e.target.value})} />
                                        </>
                                    ) : (
                                        <>
                                            <input placeholder="Görev Adı" className="w-full p-3 bg-gray-50 rounded-lg border" value={form.title} onChange={e=>setForm({...form, title: e.target.value})} />
                                            <input type="number" placeholder="Süre (dk)" className="w-full p-3 bg-gray-50 rounded-lg border" value={form.time} onChange={e=>setForm({...form, time: e.target.value})} />
                                        </>
                                    )}

                                    <button onClick={modal.type === 'project' ? addProject : modal.type === 'slice' ? addSlice : addTask} className="w-full bg-indigo-600 text-white p-3 rounded-lg font-bold mt-2">
                                        Kaydet
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>